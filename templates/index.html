<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fake News Detector Pro</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body { 
            font-family: Arial, sans-serif; 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-top: 20px;
        }
        h1 { 
            color: white; 
            text-align: center; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            margin: 0;
        }
        .header { 
            background: rgba(255,255,255,0.1); 
            padding: 20px; 
            border-radius: 10px; 
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        .input-group {
            margin-bottom: 20px;
        }
        label { 
            display: block; 
            margin-bottom: 8px; 
            font-weight: bold;
        }
        textarea, input { 
            width: 100%; 
            padding: 12px; 
            margin: 8px 0; 
            border: 2px solid #ddd; 
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: Arial, sans-serif;
        }
        textarea:focus, input:focus { 
            border-color: #667eea; 
            outline: none;
        }
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 20px 0;
        }
        button { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white; 
            padding: 12px 25px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px;
            transition: transform 0.2s;
            flex: 1;
            min-width: 120px;
        }
        button:hover { 
            transform: translateY(-2px); 
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .result { 
            margin-top: 25px; 
            padding: 20px; 
            border-radius: 10px;
            border-left: 5px solid;
            display: none;
        }
        .result.show {
            display: block;
        }
        .reliable { 
            background: #d4edda; 
            border-color: #28a745;
        }
        .unreliable { 
            background: #f8d7da; 
            border-color: #dc3545;
        }
        .warning { 
            background: #fff3cd; 
            border-color: #ffc107;
        }
        .error { 
            background: #f8d7da; 
            border-color: #dc3545;
        }
        .stats-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 15px; 
            margin: 15px 0;
        }
        .stat-card { 
            background: white; 
            padding: 15px; 
            border-radius: 8px; 
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid #eee;
        }
        .admin-panel { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 20px 0;
            border-left: 4px solid #667eea;
        }
        .loading { 
            text-align: center; 
            padding: 20px;
        }
        #newsText {
            resize: vertical;
            min-height: 120px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç Fake News Detector Pro</h1>
        <p style="color: white; text-align: center; margin: 10px 0 0 0;">–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω–æ—Å—Ç—å –Ω–æ–≤–æ—Å—Ç–µ–π —Å –ø–æ–º–æ—â—å—é AI</p>
    </div>

    <div class="container">
        <form id="newsForm" onsubmit="return false;">
            <div class="input-group">
                <label for="newsText"><b>–¢–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏:</b></label>
                <textarea id="newsText" name="news_text" rows="6" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞...">{{ news_text if news_text else '' }}</textarea>
            </div>
            
            <div class="input-group">
                <label for="newsUrl"><b>URL –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):</b></label>
                <input type="text" id="newsUrl" name="news_url" placeholder="https://example.com/news...">
            </div>
            
            <div class="button-group">
                <button type="button" onclick="analyzeNews()">üîç –ê–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤–æ—Å—Ç—å</button>
                <button type="button" onclick="clearForm()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                <button type="button" onclick="showExample()">üìã –ü—Ä–∏–º–µ—Ä</button>
            </div>
        </form>

        <div id="result" class="result {% if prediction_text %}show{% endif %} {{ prediction_class if prediction_class else '' }}">
            {% if prediction_text %}
                <h2>{{ prediction_text }}</h2>
                {% if confidence_text %}
                <p><b>{{ confidence_text }}</b></p>
                {% endif %}
            {% endif %}
        </div>

        <div class="admin-panel">
            <h3>‚öôÔ∏è –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h3>
            <button type="button" onclick="checkStatus()">üìä –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã</button>
            <div id="adminResult" style="margin-top: 10px;"></div>
        </div>
    </div>

    <script>
        // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∞–Ω–∞–ª–∏–∑–∞ –Ω–æ–≤–æ—Å—Ç–∏ —á–µ—Ä–µ–∑ AJAX
        async function analyzeNews() {
            const text = document.getElementById('newsText').value.trim();
            const url = document.getElementById('newsUrl').value.trim();
            
            if (!text) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏');
                return;
            }
            
            showLoading();
            
            try {
                // –ò—Å–ø–æ–ª—å–∑—É–µ–º FormData –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã
                const formData = new FormData();
                formData.append('news_text', text);
                if (url) {
                    formData.append('news_url', url);
                }
                
                const response = await fetch('/predict', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                // –ü–æ–ª—É—á–∞–µ–º HTML –æ—Ç–≤–µ—Ç
                const resultHtml = await response.text();
                
                // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = resultHtml;
                
                // –ù–∞—Ö–æ–¥–∏–º —ç–ª–µ–º–µ–Ω—Ç —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
                const newResult = tempDiv.querySelector('#result');
                const currentResult = document.getElementById('result');
                
                if (newResult) {
                    currentResult.innerHTML = newResult.innerHTML;
                    currentResult.className = newResult.className + ' show';
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ: ' + error.message);
            }
        }

        // –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è —á–µ—Ä–µ–∑ JSON API
        async function analyzeNewsAPI() {
            const text = document.getElementById('newsText').value.trim();
            const url = document.getElementById('newsUrl').value.trim();
            
            if (!text) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –Ω–æ–≤–æ—Å—Ç–∏');
                return;
            }
            
            showLoading();
            
            try {
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        url: url || ''
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.status === 'success') {
                    displayAPIResult(data);
                } else {
                    throw new Error(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞:', error);
                showError('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ: ' + error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∏–∑ API
        function displayAPIResult(data) {
            const resultDiv = document.getElementById('result');
            const confidencePercent = (data.confidence * 100).toFixed(1);
            const predictionClass = data.result === 'RELIABLE' ? 'reliable' : 'unreliable';
            const predictionText = data.result === 'RELIABLE' ? '‚úÖ –î–û–°–¢–û–í–ï–†–ù–ê–Ø –ù–û–í–û–°–¢–¨' : '‚ùå –ù–ï–î–û–°–¢–û–í–ï–†–ù–ê–Ø –ù–û–í–û–°–¢–¨';
            
            const html = `
                <h2>${predictionText}</h2>
                <p><b>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏:</b> ${confidencePercent}%</p>
                <p><b>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:</b> ${(data.probability * 100).toFixed(1)}%</p>
                <div class="stats-grid">
                    <div class="stat-card">
                        <b>–°—Ç–∞—Ç—É—Å</b><br>
                        ${data.result === 'RELIABLE' ? '‚úÖ –ù–∞–¥–µ–∂–Ω—ã–π' : '‚ùå –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π'}
                    </div>
                    <div class="stat-card">
                        <b>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å</b><br>
                        ${confidencePercent}%
                    </div>
                    <div class="stat-card">
                        <b>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏</b><br>
                        ${data.result === 'RELIABLE' ? confidencePercent : (100 - confidencePercent).toFixed(1)}%
                    </div>
                    <div class="stat-card">
                        <b>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Ñ–µ–π–∫–∞</b><br>
                        ${data.result === 'RELIABLE' ? (100 - confidencePercent).toFixed(1) : confidencePercent}%
                    </div>
                </div>
                <p><small>–ê–Ω–∞–ª–∏–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω —Å –ø–æ–º–æ—â—å—é –≥–∏–±—Ä–∏–¥–Ω–æ–π –º–æ–¥–µ–ª–∏ CNN-LSTM</small></p>
            `;
            
            resultDiv.innerHTML = html;
            resultDiv.className = `result ${predictionClass} show`;
        }

        // –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ —Å–∏—Å—Ç–µ–º—ã
        async function checkStatus() {
            const adminResult = document.getElementById('adminResult');
            adminResult.innerHTML = '<div class="loading">üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞...</div>';
            
            try {
                const response = await fetch('/health');
                const status = await response.json();
                
                let statusHtml = `
                    <b>–°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:</b><br>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <b>–ú–æ–¥–µ–ª—å</b><br>
                            ${status.model_loaded ? '‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–∞' : '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}
                        </div>
                        <div class="stat-card">
                            <b>–¢–æ–∫–µ–Ω–∞–π–∑–µ—Ä</b><br>
                            ${status.tokenizer_loaded ? '‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω' : '‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç'}
                        </div>
                        <div class="stat-card">
                            <b>–û–±—â–∏–π —Å—Ç–∞—Ç—É—Å</b><br>
                            ${status.status === 'healthy' ? '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç' : '‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–µ–Ω'}
                        </div>
                    </div>
                `;
                
                adminResult.innerHTML = statusHtml;
                
            } catch (error) {
                adminResult.innerHTML = `<div class="error">‚ùå –û—à–∏–±–∫–∞: ${error.message}</div>`;
            }
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showLoading() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <div class="loading">
                    <h3>üîÑ –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–æ–≤–æ—Å—Ç—å...</h3>
                    <p>–≠—Ç–æ –∑–∞–π–º–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥</p>
                </div>
            `;
            resultDiv.className = 'result warning show';
        }

        function showError(message) {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = `
                <h3>‚ùå –û—à–∏–±–∫–∞</h3>
                <p>${message}</p>
                <p><small>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É</small></p>
            `;
            resultDiv.className = 'result error show';
        }

        function clearForm() {
            document.getElementById('newsText').value = '';
            document.getElementById('newsUrl').value = '';
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '';
            resultDiv.className = 'result';
        }

        function showExample() {
            document.getElementById('newsText').value = 
                'Breaking News: Scientists have discovered a new method for renewable energy that could revolutionize the industry. The technology promises to reduce carbon emissions by 50% in the next decade according to peer-reviewed research published in Nature Journal.';
            document.getElementById('newsUrl').value = 'https://bbc.com/news/science';
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫
        document.addEventListener('DOMContentLoaded', function() {
            // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ Enter –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ
            document.getElementById('newsText').addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) {
                    analyzeNews();
                }
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å (–ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã)
            const resultDiv = document.getElementById('result');
            if (resultDiv.innerHTML.trim() !== '') {
                resultDiv.classList.add('show');
            }
        });
    </script>
</body>
</html>